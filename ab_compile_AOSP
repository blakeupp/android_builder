clear 
echo "Switching to Java5, which is needed to compile AOSP"
update-java-alternatives -s java-1.5.0-sun

cd $KITCHEN_ROOT/source/projects/$AOSP_VERSION

clear
echo "Compiling Android Open Source Project..."

$KITCHEN_ROOT/scripts/ab_git_test
#make -j$(grep -c processor /proc/cpuinfo)

#cd out/target/product/generic/
cd out/target/product/desirec/

mkdir -p META-INF/com/google/android/
cp $KITCHEN_ROOT/tools/basic-update-script META-INF/com/google/android/update-script

$KITCHEN_ROOT/scripts/ab_compile_kernel

rm -r system/core
rm -r system/extras
rm -r system/wlan

echo "Copying AOSPbase.zip to Kitchen (original_update folder)"
zip -r $KITCHEN_ROOT/original_update/AOSPbase.zip system/ META-INF/ boot.img

clear
echo "Switching back to Java6, which is needed in the Kitchen to sign updates"
update-java-alternatives -s java-6-sun

