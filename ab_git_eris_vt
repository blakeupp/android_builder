mkdir -p $KITCHEN_ROOT/source/projects/froyo/vendor/cyanogen
cd $KITCHEN_ROOT/source/projects/froyo/vendor/

rm -r cyanogen/

git clone http://github.com/punk-kaos/vendor_htc_desirec.git

mv vendor_htc_desirec/ cyanogen

cd cyanogen/
perl -pi -e 's/armv6/armv5te/g' BoardConfigCommon.mk
mkdir proprietary
cp $KITCHEN_ROOT/proprietary.zip proprietary/
cp $KITCHEN_ROOT/vold.fstab .
cp $KITCHEN_ROOT/wlan.ko .
cp $KITCHEN_ROOT/kernel .

cd proprietary
unzip proprietary.zip
mkdir -p $KITCHEN_ROOT/source/projects/froyo/vendor/htc/desirec/proprietary
cp * $KITCHEN_ROOT/source/projects/froyo/vendor/htc/desirec/proprietary

cd ../

perl -pi -e 's/adb/#adb/g' extract-files.sh
#perl -pi -e 's/\/vendor\/htc/\/device\/htc/g' extract-files.sh
#perl -pi -e 's/TARGET_BOOTLOADER_LIBS := \\/#TARGET_BOOTLOADER_LIBS :=\\/g' BoardConfigCommon.mk
#perl -pi -e 's/libboot_board_desirec \\/#libboot_board_desirec \\/g' BoardConfigCommon.mk
#perl -pi -e 's/libboot_arch_msm7k \\/#libboot_arch_msm7k \\/g' BoardConfigCommon.mk
#perl -pi -e 's/libboot_arch_armv5te/#libboot_arch_armv5te/g' BoardConfigCommon.mk
echo "add_lunch_combo desirec-eng" >> vendorsetup.sh

#perl -pi -e 's/vendor/device/g' extract-files.sh

./extract-files.sh
#perl -pi -e 's/vendor/device/g' device_desirec-vendor-blobs.mk
#perl -p1 -e 's/vendor/device/g' device_desirec-device-blobs.mk

cd ../../../

rm -r out/target/product/desirec
source build/envsetup.sh
lunch desirec-eng

#update-java-alternatives -s java-1.5.0-sun
make -j4
#update-java-alternatives -s java-6-sun

